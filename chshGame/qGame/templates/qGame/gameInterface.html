<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
{% load static %}

<script src="{% static 'qGame/jQuery.js' %}"></script>
<script src="{% static 'qGame/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'qGame/chart.js' %}"></script>
<script src="{% static 'qGame/LaTeXMathML.js' %}" ></script> 
<script src="https://fred-wang.github.io/mathml.css/mspace.js"></script>
<script src="https://fred-wang.github.io/mathjax.js/mpadded-min.js"></script>

<link href="{% static 'qGame/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'qGame/styles.css' %}" rel = "stylesheet">
    <style>
        body {
          background-color: rgb(255, 255, 255);
        }
        
        h1 {
          color: maroon;
          margin-left: 40px;
        } 

        .card {
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            transition: 0.3s;
            border: 2px solid black;
        }

        .card:hover {
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
        }

        .card-body:hover{
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2); 
        }

        .container {
            padding: 2px 16px;
        }

        .parameter {
            font-weight: bold; 
            font-size: 150%
        }

        .simulationButton{
           height: 100px;
           width: 100px;
           border-radius: 100%
        }

        #myProgress {
        width: 100%;
        background-image: white;
        border-radius: 10;
        }

        #myBar {
        width: 1%;
        height: 30px;
        background-image: linear-gradient(to right, #ff0000, #0400ff, green);
        
        }

                /* Circular Progress bar */
        .circular{
        height:1000px;
        width: 1000px;
        position: absolute;
        transform:scale(2);
        }

        .circular .inner{
        position: absolute;
        z-index: 6;
        top: 50%;
        left: 50%;
        height: 800px;
        width: 800px;
        margin: -400px 0 0 -400px;
        background: #ffffff;
        border-radius: 100%;
        }
        .circular .number{
        position: absolute;
        top:50%;
        left:50%;
        transform: translate(-50%, -50%);
        z-index:10;
        font-size:18px;
        font-weight:500;
        color:#000000;
        }
        .circular .bar{
        position: absolute;
        height: 100%;
        width: 100%;
        background: rgb(255, 255, 255);
        -webkit-border-radius: 100%;
        clip: rect(0px, 1000px, 1000px, 500px);
        }
        .circle .bar .progress{
        position: absolute;
        height: 100%;
        width: 100%;
        -webkit-border-radius: 100%;
        clip: rect(0px, 500px, 1000px, 0px);
        background: #005194;
        }
        .circle .left .progress{
        z-index:1;
        animation: left 1.5s linear both;
        }
        @keyframes left{
        100%{
            transform: rotate(180deg);
        }
        }
        .circle .right {
        transform: rotate(180deg);
        z-index:3;
        
        }
        .circle .right .progress{
        animation: right 1.5s linear both;
        animation-delay:1.5s;
        }
        @keyframes right{
        100%{
            transform: rotate(180deg);
        }
        }
                
        </style>

</head>
<body>
    
</head>
<body>
    
    


CHSH GAME 
$| \Psi \rangle = \frac{|00\rangle + |11\rangle}{\sqrt{2}}$

<canvas id="myChart" width="800" height="200" style="margin: 0 auto; z-index: 200; background-color: white;"></canvas>

<!-- Here the two Arrows are drawn -->
<svg height="400" width="100%" style="position: absolute; z-index: -2">
    <symbol id="myPath" viewBox="0 0 100 100">
        <path id="lineCA" d="m -1 10 l 150 50" stroke="black" stroke-width="2" fill="none" />
        <path id="lineCB" d="m 1 10 l -150 50" stroke="black" stroke-width="2" fill="none" />
    </symbol>
    <use xlink:href="#myPath" transform="translate(525, 50) scale(0.5)" />
</svg>

<!-- The boxes with the Alien, Alice and Bob are shwon -->
<div class='card' style="margin: auto; width: 10%; height: 10%; margin-bottom: 6.5%" >
    <div class='card-body'>
        ðŸ‘½
    </div>
</div>


<div class="container-fluid" style="margin: 0 auto ;">
    <div class="row">
        <div class='card' style="margin: 0 ; margin-left:auto; width: 20%" >
            <div class='card-body'>
                <h4 class="card-title" style="font-style: italic;">Alice</h4>
                $\theta_{(x=0)}=$ <label id='t_0_descr' class="parameter">0</label><input type="range" min="-1" max="1" step="0.0625" id="t_0" value="0" oninput="getInTermsOfPi(this.id, this.value)" ><br>
                $\theta_{(x=1)}=$ <label id='t_1_descr' class="parameter">0</label> <input type="range" min="-1" max="1" step="0.0625" id="t_1" value="0" oninput="getInTermsOfPi(this.id, this.value)" >
            </div>
        </div>
        
        <div class='card'  style="margin-left: 20% ; width: 20%; border:0; box-shadow: 0 0 0 ; margin-left: 0%">
            <br><br>
             <a style="margin-left: auto; margin-right:auto"> $| \Psi \rangle = \frac{|00\rangle + |11\rangle}{\sqrt{2}}$ </a>
            <div class="holder" style="width: 100%">
            
                <div class="ellipse"></div>
                <div class="ellipse ellipse2"></div>
            </div>
        </div>  
       
        <div class='card' style="margin: 0; margin-right:auto; width: 20%">
            <div class='card-body'>
                <h4 class="card-title" style="font-style: italic;">Bob</h4>
                $\phi_{(x=0)}=$ <label id='phi_0_descr' class="parameter">0</label><input type="range" min="-1" max="1" step="0.0625" id="phi_0" value="0" oninput="getInTermsOfPi(this.id, this.value)" ><br>
                $\phi_{(x=1)}=$ <label id='phi_1_descr' class="parameter">0</label> <input type="range" min="-1" max="1" step="0.0625" id="phi_1" value="0" oninput="getInTermsOfPi(this.id, this.value)" >
            </div>
            <!-- <img class="" style="background-color: rgb(243, 243, 243);" src="{% static 'qGame/images/measurement.png' %}"  alt="âˆ¡"> --> 
        </div>
    </div>  
</div>

<div class='card' style="margin: auto;top:86%;  left:45%; width: 10.25%; margin-bottom: 6.5%; position: absolute;" >
    <div class='card-body'>
        $x\cdot y = a \bigoplus b \quad ? $
    </div>
</div>

<!-- Second paths -->
<svg height="400" width="100%" style="position: absolute; z-index: -1; border: 0px solid black ">
    <symbol id="mySecondPath" viewBox="0 0 100 100">
        <path id="lineCA" d="m 25 50 L -125 0 " stroke="black" stroke-width="2" fill="none" />
        <path id="lineCB" d="m 25 50 L 175 0 " stroke="black" stroke-width="2" fill="none" />
    </symbol>
    <use xlink:href="#mySecondPath" transform="translate(475, 2) scale(0.5)" />
</svg>



probability update <h5 id='probUpdate'></h5>
<br><br><br>
<!-- <div id="myProgress" style="width: 50%; margin:auto">
    <div id="myBar" ></div>
</div> --> 


<!-- $\lim_{x\to\infty} f(x) = k \choose r + \frac ab \sum_{n=1}^\infty a_n + 
\displaystyle{ \left\{ \frac{1}{13} \sum_{n=1}^\infty b_n \right\} }.\$ --> 

<button id="sendParameter" type="button" class="btn btn-outline-success" style="z-index:10; width: 10%">Start Simulation</button>

<p id="log"></p>

</div>

<div class="circular" style="cursor: pointer; z-index: -10; transform: scale(0.9); bottom:100px; top:8% ;left:20%; right:50%" onclick="circularProgress()" >
    <div class="inner"></div>
    <div class="number">Start</div>
    <div class="circle">
      <div class="bar left">
        <div class="progressPrelim"></div>
      </div>
      <div class="bar right">
        <div class="progressPrelim"></div>
      </div>
    </div>
  </div>


<script>
var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [0],
        datasets: [{
            label: 'Current Winning Probability',
            fill: true,
            data: [0],
            borderWidth: 2,
            borderColor: 'rgb(0, 200, 0)',
            backgroundColor: "rgba(25, 10, 103, 0.1)",
            tension: 0.1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true,
                max: 1
            },
        },
        maintainAspectRatio: false,
        responsive: false 
        
    }
});

async function addData(chart, label, data) {
    chart.data.labels.push(label);
    chart.data.datasets.forEach((dataset) => {
        dataset.data.push(data);
    });
    chart.update();
}

var n = 1

function getProbabilities() {
    $.ajax({
        data: {"t_0": $("#t_0").val() , "t_1": $("#t_1").val(), "phi_0": $("#phi_0").val(), "phi_1":$("#phi_1").val() },
        async: true, 
        success: function(response){
            $("#probUpdate").html(response['prob'])
            addData(myChart, n, response['prob']);
            n += 1; 
            $("#sendParameter").html("Start Simulation")
            $("#sendParameter").removeClass("btn-danger")
            $("#sendParameter").addClass("btn-outline-success")
            }
        })
}


$("#sendParameter").click(function(){
    $(".circular").click()
    $("#sendParameter").html("Loading ... ")
    $("#sendParameter").removeClass("btn-outline-success")
    $("#sendParameter").addClass("btn btn-danger")
    
})

$(document).keyup(function(event) {
    if (event.which === 13) {
       $("#sendParameter").click()
    }
});

function gcd(a, b) {
  if (b < 0.0000001) return a;                // Since there is a limited precision we need to limit the value.
  return gcd(b, Math.floor(a % b));           // Discard any fractions due to limitations in precision.
};


function getInTermsOfPi(targetDiv, d){
    
    len = d.toString().length - 2
    sign = Math.sign(d)
    d *= sign
    denominator = Math.pow(10, len);
    numerator = d * denominator;

    divisor = gcd(numerator, denominator);    
    numerator /= sign*divisor;                     
    denominator /= divisor;                       

    $("#"+targetDiv+"_descr").html(Math.floor(numerator) + '/' + Math.floor(denominator)+ "&pi;")
}

function wait(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
 }

 //Logic for Progress Bar 
var i = 0;

function move() {
    var elem = document.getElementById("myBar"); 
    var width = 10;
    var id = setInterval(frame, 25);
    function frame() {
        if (width >= 100) {
            clearInterval(id);
        } else {
            width++; 
            elem.style.width = width + '%'; 
            
        }
    }
}

function circularProgress(){
    getProbabilities()
    $(".inner").css("background-color", "white")
    counter = 0 
    $(".progressPrelim").removeClass("progress")
    progress = setInterval( function() {
        $(".progressPrelim").addClass("progress")
        if(counter >= 100 ){
            $(".inner").css("background-color", "#ffffff")
            $(".number").html("Start")
            clearInterval(progress);
        }else{
            counter+=1;
            $(".number").html(counter + "%")
        }
        }, 30);
    
}

 
</script>
</body>


</html>